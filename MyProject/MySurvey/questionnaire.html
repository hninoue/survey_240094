<!DOCTYPE html>
<html>
  <head>
    <title>調査_井上</title>
    <script src="https://unpkg.com/jspsych@7.3.4"></script>
    <script src="https://unpkg.com/@jspsych/plugin-preload@1.1.3"></script>
    <script src="https://unpkg.com/@jspsych/plugin-fullscreen@1.2.1"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.3"></script>
    <script src="https://unpkg.com/@jspsych/plugin-audio-keyboard-response@1.1.3"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.2.0"></script>
    <script src="https://unpkg.com/@jspsych-contrib/plugin-pipe"></script>
    <link href="https://unpkg.com/jspsych@7.3.4/css/jspsych.css" rel="stylesheet" type="text/css" />
  </head>
  <body></body>
  <script type="module">
    // Firebaseのインポート
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js';
    import { getDatabase, ref, get, set } from 'https://www.gstatic.com/firebasejs/11.1.0/firebase-database.js';
    import { getAuth, signInAnonymously } from 'https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js';

    // Firebaseの初期化
    const firebaseConfig = {
      apiKey: "AIzaSyCOBCaYXL8rOyy8Ckw32mibo0GCjjnAGaw",
      authDomain: "survey-240094.firebaseapp.com",
      databaseURL: "https://survey-240094-default-rtdb.firebaseio.com",
      projectId: "survey-240094",
      storageBucket: "survey-240094.firebasestorage.app",
      messagingSenderId: "532363065184",
      appId: "1:532363065184:web:9a3f0cf100fb660d2b5005"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);  // Firebase Authenticationのインスタンス
    const database = getDatabase(app);  // Realtime Databaseのインスタンス

    // 音声データリスト
    var audioData = [
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word000_practice.mp3", word: 'けんとうし', prosody: '音量調整' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word001_up.mp3", word: 'すききらい', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word002_no.mp3", word: 'きんみらい', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word003_no.mp3", word: 'いろなおし', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word004_up.mp3", word: 'はやとちり', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word005_up.mp3", word: 'たほうめん', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word006_no.mp3", word: 'すなあらし', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word007_no.mp3", word: 'さんかいき', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word008_up.mp3", word: 'はえたたき', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word009_no.mp3", word: 'あおにさい', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word010_up.mp3", word: 'ついしけん', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word011_up.mp3", word: 'ひるやすみ', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word012_no.mp3", word: 'やくはらい', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word013_no.mp3", word: 'にもうさく', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word014_up.mp3", word: 'つなわたり', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word015_up.mp3", word: 'うりふたつ', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word016_no.mp3", word: 'やけのはら', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word017_no.mp3", word: 'なまかわき', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word018_up.mp3", word: 'みかいけつ', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word019_up.mp3", word: 'おひとよし', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word020_no.mp3", word: 'てつあれい', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word021_up.mp3", word: 'たまひろい', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word022_no.mp3", word: 'うちいわい', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word023_no.mp3", word: 'むいちもん', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word024_up.mp3", word: 'みせいねん', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word025_up.mp3", word: 'なまけもの', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word026_no.mp3", word: 'むせいらん', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word027_no.mp3", word: 'くらやしき', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word028_up.mp3", word: 'かねもうけ', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word029_up.mp3", word: 'はやおくり', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word030_no.mp3", word: 'たこうしき', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word031_no.mp3", word: 'つみつくり', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word032_up.mp3", word: 'むせきにん', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word033_no.mp3", word: 'ねつさまし', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word034_up.mp3", word: 'くりかえし', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word035_up.mp3", word: 'たねあかし', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word036_no.mp3", word: 'ていしせい', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word037_up.mp3", word: 'むしさされ', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word038_no.mp3", word: 'はまりやく', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word039_up.mp3", word: 'ななひかり', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word040_no.mp3", word: 'ほしあかり', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word041_up.mp3", word: 'うんまかせ', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word042_no.mp3", word: 'ひこうしき', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word043_up.mp3", word: 'ものわすれ', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word044_no.mp3", word: 'ふかくてい', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word045_up.mp3", word: 'ひとつまみ', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word046_no.mp3", word: 'きねんさい', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word047_no.mp3", word: 'まえのめり', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word048_up.mp3", word: 'こうはんい', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word049_no.mp3", word: 'さらまわし', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word050_up.mp3", word: 'からまわり', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word051_no.mp3", word: 'あめおんな', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word052_up.mp3", word: 'おすそわけ', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word053_no.mp3", word: 'あしならし', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word054_up.mp3", word: 'なかなおり', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word055_up.mp3", word: 'ひなまつり', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word056_no.mp3", word: 'しんきろう', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word057_up.mp3", word: 'くさむしり', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word058_no.mp3", word: 'ひとさらい', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word059_up.mp3", word: 'ふくさよう', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word060_no.mp3", word: 'ことこまか', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word061_no.mp3", word: 'おにやんま', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word062_up.mp3", word: 'はかまいり', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word063_up.mp3", word: 'むこようし', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word064_no.mp3", word: 'おみとおし', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word065_up.mp3", word: 'くみあわせ', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word066_no.mp3", word: 'まてんろう', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word067_no.mp3", word: 'きそゆうよ', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word068_up.mp3", word: 'かたおもい', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word069_no.mp3", word: 'やまおとこ', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word070_up.mp3", word: 'いしあたま', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word071_no.mp3", word: 'しうんてん', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word072_up.mp3", word: 'てれかくし', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word073_no.mp3", word: 'たなおろし', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word074_up.mp3", word: 'おきにいり', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word075_up.mp3", word: 'そらもよう', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word076_no.mp3", word: 'かものはし', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word077_up.mp3", word: 'なきわらい', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word078_no.mp3", word: 'ゆめまくら', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word079_up.mp3", word: 'おおみそか', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word080_no.mp3", word: 'ししんけい', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word081_up.mp3", word: 'ゆめまくら', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word082_no.mp3", word: 'おきにいり', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word083_up.mp3", word: 'ほしあかり', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word084_no.mp3", word: 'はやとちり', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word085_up.mp3", word: 'にもうさく', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word086_no.mp3", word: 'たまひろい', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word087_up.mp3", word: 'くらやしき', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word088_no.mp3", word: 'いしあたま', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word089_up.mp3", word: 'おにやんま', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word090_no.mp3", word: 'てれかくし', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word091_no.mp3", word: 'かたおもい', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word092_up.mp3", word: 'なまかわき', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word093_no.mp3", word: 'はやおくり', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word094_up.mp3", word: 'ていしせい', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word095_up.mp3", word: 'やまおとこ', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word096_no.mp3", word: 'おおみそか', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word097_up.mp3", word: 'まてんろう', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word098_no.mp3", word: 'みせいねん', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word099_no.mp3", word: 'ななひかり', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word100_up.mp3", word: 'ししんけい', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word101_up.mp3", word: 'やけのはら', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word102_no.mp3", word: 'すききらい', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word103_no.mp3", word: 'おすそわけ', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word104_up.mp3", word: 'おみとおし', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word105_no.mp3", word: 'なかなおり', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word106_up.mp3", word: 'まえのめり', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word107_up.mp3", word: 'すなあらし', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word108_no.mp3", word: 'むしさされ', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word109_no.mp3", word: 'くみあわせ', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word110_up.mp3", word: 'たなおろし', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word111_no.mp3", word: 'ひとつまみ', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word112_up.mp3", word: 'かものはし', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word113_up.mp3", word: 'あおにさい', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word114_no.mp3", word: 'ついしけん', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word115_no.mp3", word: 'くさむしり', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word116_up.mp3", word: 'しんきろう', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word117_no.mp3", word: 'ひなまつり', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word118_up.mp3", word: 'さんかいき', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word119_no.mp3", word: 'こうはんい', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word120_up.mp3", word: 'むせいらん', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word121_no.mp3", word: 'はえたたき', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word122_up.mp3", word: 'きんみらい', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word123_up.mp3", word: 'きそゆうよ', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word124_no.mp3", word: 'かねもうけ', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word125_no.mp3", word: 'ふくさよう', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word126_up.mp3", word: 'いろなおし', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word127_up.mp3", word: 'ふかくてい', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word128_no.mp3", word: 'くりかえし', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word129_up.mp3", word: 'きねんさい', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word130_no.mp3", word: 'からまわり', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word131_up.mp3", word: 'ことこまか', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word132_no.mp3", word: 'なきわらい', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word133_no.mp3", word: 'たねあかし', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word134_up.mp3", word: 'うちいわい', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word135_no.mp3", word: 'むこようし', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word136_up.mp3", word: 'ひこうしき', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word137_no.mp3", word: 'なまけもの', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word138_up.mp3", word: 'ねつさまし', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word139_no.mp3", word: 'みかいけつ', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word140_up.mp3", word: 'むいちもん', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word141_no.mp3", word: 'うりふたつ', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word142_up.mp3", word: 'つみつくり', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word143_no.mp3", word: 'おひとよし', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word144_up.mp3", word: 'しうんてん', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word145_no.mp3", word: 'つなわたり', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word146_up.mp3", word: 'たこうしき', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word147_no.mp3", word: 'そらもよう', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word148_up.mp3", word: 'てつあれい', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word149_up.mp3", word: 'ひとさらい', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word150_no.mp3", word: 'むせきにん', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word151_no.mp3", word: 'ものわすれ', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word152_up.mp3", word: 'あしならし', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word153_no.mp3", word: 'はかまいり', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word154_up.mp3", word: 'あめおんな', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word155_up.mp3", word: 'さらまわし', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word156_no.mp3", word: 'たほうめん', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word157_up.mp3", word: 'はまりやく', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word158_no.mp3", word: 'ひるやすみ', prosody: '抑揚なし' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word159_up.mp3", word: 'やくはらい', prosody: '抑揚あり' },
      { file: "https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/word160_no.mp3", word: 'うんまかせ', prosody: '抑揚なし' },
    ];

    // 音声データの分割
    var volumeAdjustmentAudio = audioData[0]; // 音量調整フェイズ用の音声
    var mainAudioData = audioData.slice(1);   // 本試行用の音声

    // Firebaseの匿名認証を実行
    signInAnonymously(auth)
      .then(() => {
        console.log('匿名認証に成功しました');

        // サインイン後、ユーザーIDを取得
        const user = auth.currentUser;
        console.log("参加者ID:", user.uid);

        // Firebase Realtime Databaseの参加者番号の取得と更新
        const participantRef = ref(database, 'current_participant_number');
        get(participantRef).then(snapshot => {
            let currentNumber = snapshot.exists() ? snapshot.val() : 0; // データが存在しない場合は0
            let nextNumber = currentNumber + 1; // 次の番号を決定
            set(participantRef, nextNumber); // 次の番号をデータベースに保存
            console.log("次の参加者ID:", nextNumber);

            // 音声データリストの順番を決定（正順または逆順）
            let trialOrder;
            if (nextNumber % 2 === 1) {
                trialOrder = mainAudioData; // 正順
            } else {
                trialOrder = mainAudioData.reverse(); // 逆順
            }

            // jsPsychの初期化
            const jsPsych = initJsPsych({
              on_finish: function() {
                console.log("実験が完了しました");
              }
            });

            // 参加者情報をjsPsychデータに追加
            jsPsych.data.addProperties({
                participant_id: nextNumber, // 数字のIDを使用
                trial_order: trialOrder.map(item => item.file) // 提示順の音声ファイル名を記録
            });

            // jsPsychの初期化関数を実行
            initJsPsychExperiment(jsPsych, trialOrder, nextNumber);

        }).catch(error => {
            console.error("エラーが発生しました:", error);
        });
      })
      .catch((error) => {
        console.error("匿名認証エラー:", error);
      });

    // 実験の初期化関数
    function initJsPsychExperiment(jsPsych, trialOrder, nextNumber) {
      // プリロード設定
      var preload = {
        type: jsPsychPreload,
        audio: trialOrder.map(item => item.file), // 音声ファイルをプリロード
        images: ["https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/image000_scale.png"]
      };

      // フルスクリーン
      var enterFullscreen = {
        type: jsPsychFullscreen,
        fullscreen_mode: true,
        message: `<p>調査を開始するには「続ける」ボタンをクリックして、フルスクリーンモードに切り替えてください。</p>`,
        button_label: "続ける"
      };

      // 音量調整フェイズ：教示
      var volumeInstruction = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: `
          <h1>事前準備</h1>
          <p>これから調査の準備を始めます。</p>
          <style>
            ul, li {
              text-align: left;
            }
          </style>
          <ul>
              <li><b>お願い１</b><br>パソコン以外の機器の電源をOFFにして雑音が聞こえないようにしてください。</li>
              <li><b>お願い２</b><br>１人きりになれる静かな環境に移動してください。</li>
              <li><b>お願い３</b><br>ヘッドフォンまたはイヤフォンを装着してください。</li>
              <li><b>お願い４</b><br>次画面においてテスト音声が流れますので、聞こえやすい音量に調整してください。</li>
          </ul>
          <br><br><b>上記の内容について準備できましたら、スペースキーを押してください</b>
        `,
        choices: [' ']
      };

      // 音量調整フェイズ：操作
      var volumeAdjustment = {
        type: jsPsychAudioKeyboardResponse,
        stimulus: volumeAdjustmentAudio.file, // リストの最初の音声ファイルを指定
        prompt: `
          <h1>音量調整</h1>
          <p>聞こえやすい音量に調整してください。</p>
          <br><br><b>上記の内容について準備できましたら、スペースキーを押してください</b>
        `,
        choices: [' '],
        trial_ends_after_audio: false, // 音声が再生されても試行が終了しない
      };

      // 本試行：教示
      var mainInstruction = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: `
          <h1>調査内容</h1>
          <p>これから調査を始めます。</p>
          <p style="text-align: left;">この調査では、<b>話し方の自然さ</b>を調べます。</p>
          <p style="text-align: left;">提示された音声が、<b>どの程度自然に話しているように聞こえるか</b>を6段階で判断してください。</p>
          <style>
            ul, li {
              text-align: left;
            }
          </style>
          <ul>
              <li><b>留意事項１:</b><br>提示された音声について<u>自然だと思う場合</u>は<b>大きな数字</b>を、<u>不自然だと思う場合</u>は<b>小さな数字</b>を選択してください。</li>
              <li><b>留意事項２:</b><br>試行数は全部で160試行ですが、80試行目で約30秒間の小休憩を取ります。</li>
              <li><b>留意事項３:</b><br>同じ言葉が何回も流れますが、気にする必要はありません。</li>
          </ul>
          <br><br><b>上記の内容について理解できましたら、スペースキーを押してください（回答練習へ）</b>
        `,
        choices: [' ']
      };

      // 本試行：練習
      var mainPractice = {
        type: jsPsychHtmlButtonResponse,
        stimulus: `
          <h1>回答練習</h1>
          <p>「5: やや自然である」と回答する場合を想定して、「5」のボタンをクリックしてみてください。</p>
          <br><br><p><b>質問:</b> この音声はどの程度自然に話しているように聞こえますか？</p>
        `,
        prompt: `
          <div style="text-align: center; margin-bottom: 20px;">
            <img src="https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/image000_scale.png" 
              alt="数直線" 
              style="max-width: 80%; height: auto;">
          </div>
          <div style="display: flex; align-items: center; justify-content: center;">
            <span style="margin-right: 20px; font-weight: bold;">不自然である</span>
            <div id="custom-button-container" style="display: flex; gap: 10px;"></div>
            <span style="margin-left: 20px; font-weight: bold;">自然である</span>
          </div>
        `,
        choices: [], // ボタン生成を無効化
        on_load: function () {
          // カスタムボタンの生成と挿入
          const buttonContainer = document.getElementById("custom-button-container");
          for (let i = 0; i < 6; i++) {
            const button = document.createElement("button");
            button.classList.add("jspsych-btn");
            button.innerText = i + 1; // ボタンに番号を表示
            button.dataset.choice = i; // 選択値を設定
            button.style.fontSize = "24px"; // 文字サイズを大きく
            button.style.padding = "20px"; // ボタンのパディングを増加（大きくする）
            button.style.width = "80px"; // ボタンの幅を設定
            button.style.height = "80px"; // ボタンの高さを設定
            button.style.margin = "0 30px";  // ボタン間に左右15pxの間隔を追加
            button.style.marginLeft = "15px";  // ボタンを左に15px移動
            button.addEventListener("click", function () {
              let response = parseInt(this.dataset.choice);
              if (response !== 4) {
                // 「5」を選択しなければ再試行を追加
                jsPsych.addNodeToEndOfTimeline({
                  timeline: [mainPractice]
                });
                alert("正しい回答を選択してください。「5: やや自然である」をクリックしてください。");
              } else {
                // 正解の場合、試行を終了
                jsPsych.finishTrial({ response: response });
              }
            });
            buttonContainer.appendChild(button);
         }
        },
        data: {
          practice: true, // 練習用であることを示すデータ
          correct_choice: "5" // 正解は「5」
        }
      };

      // 本試行：教示（再掲）
      var mainInstruction2 = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: `
          <h1>調査内容（再掲）</h1>
          <p>これから調査を始めます。</p>
          <p style="text-align: left;">この調査では、<b>話し方の自然さ</b>を調べます。</p>
          <p style="text-align: left;">提示された音声が、<b>どの程度自然に話しているように聞こえるか</b>を6段階で判断してください。</p>
          <style>
            ul, li {
              text-align: left;
            }
          </style>
          <ul>
              <li><b>留意事項１:</b><br>提示された音声について<u>自然だと思う場合</u>は<b>大きな数字</b>を、<u>不自然だと思う場合</u>は<b>小さな数字</b>を選択してください。</li>
              <li><b>留意事項２:</b><br>試行数は全部で160試行ですが、80試行目で約30秒間の小休憩を取ります。</li>
              <li><b>留意事項３:</b><br>同じ言葉が何回も流れますが、気にする必要はありません。</li>
          </ul>
          <br><br><b>上記の内容について理解できましたら、スペースキーを押してください（本試行へ）</b>
        `,
        choices: [' ']
      };

      // 本試行：操作
      var mainTrials = [];
      trialOrder.forEach(function(trial, index) {
        // 音声提示と自然さの評価を同時に行う
        mainTrials.push({
          type: jsPsychHtmlButtonResponse, // 一つの画面で提示
          stimulus: `
            <div>
              <audio id="audio-player" src="${trial.file}" autoplay></audio>
              <p><b>質問:</b> この音声はどの程度自然に話しているように聞こえますか？</p>
              <div style="text-align: center; margin: 20px 0;">
                <img src="https://raw.githubusercontent.com/hninoue/survey_240094/main/MyProject/MySurvey/image000_scale.png" 
                     alt="数直線" 
                     style="max-width: 80%; height: auto;">
              </div>
            </div>
          `,
          prompt: `
            <div style="display: flex; align-items: center; justify-content: center;">
              <span style="margin-right: 20px; font-weight: bold;">不自然である</span>
              <div id="custom-button-container" style="display: flex; gap: 10px;"></div>
              <span style="margin-left: 20px; font-weight: bold;">自然である</span>
            </div>
          `,
          choices: [], // デフォルトのボタン生成を無効化
          on_load: function () {
            // カスタムボタンの生成と挿入
            const buttonContainer = document.getElementById("custom-button-container");
            if (buttonContainer) {
              console.log("ボタンコンテナが見つかりました。ボタンを追加します。"); // ログで確認
              for (let i = 0; i < 6; i++) {
                const button = document.createElement("button");
                button.classList.add("jspsych-btn");
                button.innerText = i + 1; // ボタンに番号を表示
                button.dataset.choice = i; // 選択値を設定
                button.style.fontSize = "24px"; // 文字サイズを大きく
                button.style.padding = "20px"; // ボタンのパディングを増加（大きくする）
                button.style.width = "80px"; // ボタンの幅を設定
                button.style.height = "80px"; // ボタンの高さを設定
                button.style.margin = "0 30px";  // ボタン間に左右15pxの間隔を追加
                button.style.marginLeft = "15px";  // ボタンを左に15px移動
                button.addEventListener("click", function () {
                  jsPsych.finishTrial({ response: parseInt(this.dataset.choice) });
                });
                buttonContainer.appendChild(button);
              }
            } else {
              console.log("ボタンコンテナが見つかりませんでした。"); // コンテナが見つからなかった場合のログ
            }
      
            // 音声が準備できたら試行を開始
            const audioPlayer = document.getElementById('audio-player');
            audioPlayer.oncanplaythrough = function() {
              // 音声が準備完了したら試行を終了させる
              console.log("音声がロードされ、再生準備が整いました。");
            };
          },
          data: {
            participant_id: nextNumber, // 参加者IDを記録
            audio_file: trial.file,       // 提示された音声ファイル名を記録
            word: trial.word,             // 単語情報
            prosody: trial.prosody,       // 抑揚情報
            trial_index: index + 1        // 試行番号
          },
          trial_ends_after_audio: true  // 音声が再生された後に試行を終了
        });

        // 80試行目終了後に休憩を挿入
        if ((index + 1) === 80) {
          mainTrials.push({
            type: jsPsychHtmlButtonResponse,
            stimulus: `
              <h1>休憩</h1>
              <p>30秒の休憩時間です。</p>
              <p>画面に表示された「再開」ボタンが有効になるまでお待ちください。</p>
              <p>ヘッドフォンまたはイヤフォンを装着したまま、リラックスしてその場でお待ちください。</p>
            `,
            choices: ['再開'], // 「再開」ボタンを表示
            prompt: `<p id="timer-message"></p>`, // タイマーのメッセージを表示
            button_html: `<button class="jspsych-btn" id="resume-button" disabled>%choice%</button>`, // ボタンを無効化
            on_load: function () {
              // 30秒後にボタンを有効化
              setTimeout(() => {
                document.getElementById("resume-button").disabled = false; // ボタンを有効化
                document.getElementById("timer-message").innerText = "30秒が経過しました。「再開」ボタンを押して続行してください。";
              }, 30000);
            },
         });
        }
      });

      // ファイル名としてsubject_idを使用
      const subject_id = jsPsych.randomization.randomID(10);
      const filename = `${subject_id}.csv`; 

      // 終了時のコード提示
      var showCode = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: function() {
          // subject_idをデータに追加
          jsPsych.data.addDataToLastTrial({ subject_id: subject_id });

          return `
            <h1>調査終了</h1>
            <p>調査にご協力くださり誠にありがとうございました。</p>
            <style>
              ul, li {
                text-align: left;
              }
            </style>
            <ul>
              <li><b>お願い１:</b><br>Amazonギフト券をお送りするために、法政Gmailアドレスが必要です。</li>
              <li><b>お願い２:</b><br>下記の英数字コードをメモ（コピー＆ペースト）してください。<br>それが困難な場合には，スクリーンショットを保存してください。</li>
            </ul>
            <br><br><b>英数字コード: <strong>${subject_id}</strong></b>
            <br><br><b>コードを控えることができましたら、スペースキーを押してください</b>
          `;
        },
        choices: [' ']
      };

      //データ保存
      const save_data = {
        type: jsPsychPipe,
        action: "save",
        experiment_id: "ZWmEpETHLVnZ",
        filename: filename,
        data_string: ()=>jsPsych.data.get().csv()
      };

      // save_dataの後に表示する試行
      var finalMessage = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: `
          <p style="text-align: left;">改めまして、</p>
          <p style="text-align: left;">調査にご協力くださり誠にありがとうございました。</p>
          <p style="text-align: left;"><b>下記のURLをコピーして、新しいブラウザを開き、URLを貼り付けてください。</b></p>
          <p style="text-align: left;">＊URLは、謝礼を送るのに必要な情報を記入していただくGoogleフォームにつながっています。</p>
          <br><br><p>https://forms.gle/fLSUF5Epfn5qnCWYA</p>
          <br><br><b>上記の手順を終えましたら、こちらのブラウザを閉じてください。</b>
        `,
        choices: "NO_KEYS", // キー入力なし
      };
    };

    // 実験の実行
    jsPsych.run([
      preload,            // 刺激のプリロード
      enterFullscreen,    // フルスクリーン
      volumeInstruction,  // 音量調整フェイズ：教示
      volumeAdjustment,   // 音量調整フェイズ：操作
      mainInstruction,    // 本試行：教示
      mainPractice,       // 本試行：練習
      mainInstruction2,   // 本試行：教示（再掲）
      ...mainTrials,      // 本試行：操作
      showCode,           // 終了時のコード提示
      save_data,           // データ保存
      finalMessage        // 最後のメッセージ
    ]);
  </script>
</html>
